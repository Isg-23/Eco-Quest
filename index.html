<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco-Quest üå± - Save Our Planet!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2d5016;
            overflow-x: hidden;
        }

        .floating-elements {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .leaf, .cloud, .star {
            position: absolute;
            animation: float 6s ease-in-out infinite;
        }

        .leaf {
            font-size: 24px;
            color: #4CAF50;
            animation-delay: 0s;
        }

        .cloud {
            font-size: 32px;
            color: rgba(255, 255, 255, 0.7);
            animation-delay: -2s;
        }

        .star {
            font-size: 16px;
            color: #FFD700;
            animation-delay: -4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        header {
            background: linear-gradient(135deg, #2E8B57, #228B22);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: "üåç";
            animation: spin 4s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        nav a:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        /* New Styles for logged-in state */
        .user-info {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-stats {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            font-size: 1.5rem;
        }

        .hero {
            text-align: center;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="trees" patternUnits="userSpaceOnUse" width="20" height="20"><text x="2" y="15" font-size="12" fill="rgba(255,255,255,0.1)">üå≤</text></pattern></defs><rect width="100" height="100" fill="url(%23trees)"/></svg>');
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .cta-button {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .cta-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .cta-button:active {
            transform: translateY(-1px) scale(1.02);
        }

        .section {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: #2E7D32;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .quest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .quest-card {
            background: linear-gradient(145deg, #ffffff, #f0f8f0);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 3px solid #E8F5E8;
        }

        .quest-card::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quest-card:hover::before {
            opacity: 1;
        }

        .quest-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-color: #4CAF50;
        }

        .quest-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 1rem;
            display: block;
        }

        .quest-card h3 {
            color: #2E7D32;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .quest-card p {
            color: #555;
            margin-bottom: 1.5rem;
            text-align: center;
            line-height: 1.6;
        }

        .quest-button {
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quest-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .quest-button:hover::before {
            left: 100%;
        }

        .quest-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .difficulty {
            display: inline-block;
            background: #FFE082;
            color: #F57F17;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .profile-container {
            background: linear-gradient(145deg, #ffffff, #f0f8f0);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .badges-container {
            margin-top: 2rem;
        }

        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
        }

        .badge {
            background: white;
            border-radius: 15px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .badge:hover {
            transform: scale(1.05);
        }

        .badge-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .badge-name {
            font-size: 0.8rem;
            color: #555;
            font-weight: bold;
        }

        .badge.locked {
            opacity: 0.5;
            background: #f5f5f5;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(145deg, #ffffff, #f0f8f0);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .game-area {
            text-align: center;
            padding: 2rem 0;
        }

        .recycling-bins {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .bin {
            width: 100px;
            height: 120px;
            border: 3px dashed #ccc;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .bin.highlight {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .bin-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .bin-label {
            font-size: 0.8rem;
            font-weight: bold;
            color: #555;
        }

        .draggable-items {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }

        .draggable-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 1rem;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 1.5rem;
            min-width: 60px;
            text-align: center;
        }

        .draggable-item:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .draggable-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .quest-grid {
                grid-template-columns: 1fr;
            }

            .recycling-bins {
                flex-direction: column;
                align-items: center;
            }
        }

        @keyframes success {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); background: #4CAF50; }
            100% { transform: scale(1); }
        }

        .success-animation {
            animation: success 0.5s ease-in-out;
        }

        .progress-container {
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar {
            height: 20px;
            background: linear-gradient(45deg, #4CAF50, #81C784);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .confetti {
            position: absolute;
            font-size: 20px;
            animation: confetti-fall 3s ease-in-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                opacity: 1;
                transform: translateY(-100vh) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(300px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: loading-spin 1s ease-in-out infinite;
        }

        @keyframes loading-spin {
            to { transform: rotate(360deg); }
        }

        /* NEW STYLES for Login/Signup and Leaderboard */
        .auth-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 1rem;
            text-align: center;
        }

        .auth-container h3 {
            color: #2E7D32;
        }

        .auth-container input {
            padding: 0.8rem;
            border-radius: 10px;
            border: 2px solid #ddd;
            width: 100%;
            font-size: 1rem;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }

        .auth-container button {
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .auth-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .switch-auth {
            font-size: 0.9rem;
            cursor: pointer;
            color: #667eea;
            text-decoration: underline;
        }
        
        /* Leaderboard styles */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 2rem;
        }

        .leaderboard-table th, .leaderboard-table td {
            text-align: left;
            padding: 1rem;
            border-bottom: 1px solid #ddd;
        }

        .leaderboard-table th {
            background-color: #f2f2f2;
            color: #2E7D32;
        }

        .leaderboard-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .leaderboard-table tr:hover {
            background-color: #e8f5e8;
        }
        
        .leaderboard-table tr.user-rank {
            background-color: #c8e6c9;
            font-weight: bold;
        }
        
        /* New styles for learning content */
        .learning-content {
            text-align: left;
        }
        .learning-content h3 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #2E7D32;
        }
        .learning-content p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #555;
            margin-bottom: 1.5rem;
        }
        .learning-content ul {
            list-style: none;
            padding: 0;
            margin-bottom: 1.5rem;
        }
        .learning-content ul li {
            background: #E8F5E8;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 5px solid #4CAF50;
        }
        
        /* Styles for profile icon selection */
        .icon-selection {
            text-align: center;
            margin-top: 1.5rem;
        }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin-top: 1rem;
        }
        .icon-option {
            font-size: 2rem;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            background: #e0e0e0;
        }
        .icon-option:hover {
            transform: scale(1.1);
        }
        .icon-option.selected {
            border-color: #4CAF50;
            background: #c8e6c9;
        }
        
        /* New styles for profile avatar display */
        .profile-avatar-large {
            font-size: 5rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .profile-username {
            font-size: 2rem;
            text-align: center;
            font-weight: bold;
            color: #2E7D32;
        }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="leaf" style="left: 10%; top: 20%;">üçÉ</div>
        <div class="cloud" style="left: 80%; top: 15%;">‚òÅÔ∏è</div>
        <div class="leaf" style="left: 70%; top: 60%;">üåø</div>
        <div class="star" style="left: 20%; top: 70%;">‚≠ê</div>
        <div class="cloud" style="left: 40%; top: 80%;">‚òÅÔ∏è</div>
        <div class="leaf" style="left: 90%; top: 40%;">üçÉ</div>
    </div>

    <header>
        <div class="nav-container">
            <div class="logo">Eco-Quest</div>
            <nav>
                <ul>
                    <li><a href="#home" onclick="showSection('home')">üè† Home</a></li>
                    <li><a href="#quests" onclick="showSection('quests')">üéÆ Quests</a></li>
                    <li><a href="#learn" onclick="showSection('learn')">üìö Learn</a></li>
                    <li><a href="#profile" onclick="showSection('profile')">üë§ Profile</a></li>
                    <li><a href="#leaderboard" onclick="showSection('leaderboard')">üèÜ Leaderboard</a></li>
                </ul>
            </nav>
            <div id="user-display">
                <a href="#" class="user-stats" onclick="openAuthModal()">
                    <span>üë§ Login/Sign Up</span>
                </a>
            </div>
        </div>
    </header>

    <section id="home" class="hero">
        <div class="hero-content">
            <h1>üå± Welcome to Eco-Quest! üå±</h1>
            <p>Join the adventure to save our planet! Learn about nature, sustainability, and environmental protection through fun interactive quests and games.</p>
            <button class="cta-button" onclick="startAdventure()">
                üöÄ Start Your Green Adventure!
            </button>
        </div>
    </section>

    <section id="quests" class="section" style="display: none;">
        <h2>üéØ Your Eco-Missions</h2>
        <div class="quest-grid">
            <div class="quest-card">
                <div class="difficulty">‚≠ê Beginner</div>
                <div class="quest-icon">‚ôªÔ∏è</div>
                <h3>Recycling Hero</h3>
                <p>Learn to sort different types of waste into the correct recycling bins. Help reduce pollution and save our planet!</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 0%">0%</div>
                </div>
                <button class="quest-button" onclick="if (checkLoginAndRedirect()) { startRecyclingGame(); }">Start Mission</button>
            </div>
            
            <div class="quest-card">
                <div class="difficulty">‚≠ê‚≠ê Intermediate</div>
                <div class="quest-icon">üå≥</div>
                <h3>Forest Guardian</h3>
                <p>Protect the rainforest by planting trees and learning about wildlife conservation. Every tree counts!</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 0%">0%</div>
                </div>
                <button class="quest-button" onclick="if (checkLoginAndRedirect()) { startForestGame(); }">Start Mission</button>
            </div>
            
            <div class="quest-card">
                <div class="difficulty">‚≠ê‚≠ê‚≠ê Advanced</div>
                <div class="quest-icon">‚òÄÔ∏è</div>
                <h3>Solar City Builder</h3>
                <p>Design and build a sustainable city powered entirely by renewable energy sources!</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 0%">0%</div>
                </div>
                <button class="quest-button" onclick="if (checkLoginAndRedirect()) { startSolarGame(); }">Start Mission</button>
            </div>
        </div>
    </section>

    <section id="learn" class="section" style="display: none;">
        <h2>üìñ Environmental Knowledge Hub</h2>
        <div class="quest-grid">
            <div class="quest-card">
                <div class="quest-icon">üåç</div>
                <h3>Climate Change Basics</h3>
                <p>Discover what climate change is and how it affects our planet.</p>
                <button class="quest-button" onclick="showClimateChangeInfo()">Learn More</button>
            </div>
            
            <div class="quest-card">
                <div class="quest-icon">üêº</div>
                <h3>Wildlife Conservation</h3>
                <p>Learn about endangered species and how we can protect them.</p>
                <button class="quest-button" onclick="showWildlifeInfo()">Learn More</button>
            </div>
            
            <div class="quest-card">
                <div class="quest-icon">üåä</div>
                <h3>Ocean Protection</h3>
                <p>Understand ocean pollution and marine ecosystem protection.</p>
                <button class="quest-button" onclick="showOceanInfo()">Learn More</button>
            </div>
        </div>
    </section>

    <section id="profile" class="section" style="display: none;">
        <h2>üèÜ Your Eco-Profile</h2>
        <div id="profile-content">
            <div class="profile-container">
                <div class="profile-avatar-large" id="profile-avatar">üë§</div>
                <div class="profile-username" id="profile-username">Guest</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="eco-points">0</div>
                        <div class="stat-label">üåü Eco-Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="quests-completed">0</div>
                        <div class="stat-label">‚úÖ Quests Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="badges-earned">0</div>
                        <div class="stat-label">üèÖ Badges Earned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="streak-days">0</div>
                        <div class="stat-label">üî• Day Streak</div>
                    </div>
                </div>
                
                <div class="badges-container">
                    <h3>üèÖ Your Eco-Badges</h3>
                    <div class="badges-grid">
                        <div class="badge locked" data-badge="recycling-novice">
                            <div class="badge-icon">‚ôªÔ∏è</div>
                            <div class="badge-name">Recycling Novice</div>
                        </div>
                        <div class="badge locked" data-badge="tree-planter">
                            <div class="badge-icon">üå≥</div>
                            <div class="badge-name">Tree Planter</div>
                        </div>
                        <div class="badge locked" data-badge="energy-saver">
                            <div class="badge-icon">‚ö°</div>
                            <div class="badge-name">Energy Saver</div>
                        </div>
                        <div class="badge locked" data-badge="ocean-protector">
                            <div class="badge-icon">üåä</div>
                            <div class="badge-name">Ocean Protector</div>
                        </div>
                        <div class="badge locked" data-badge="wildlife-friend">
                            <div class="badge-icon">üêº</div>
                            <div class="badge-name">Wildlife Friend</div>
                        </div>
                        <div class="badge locked" data-badge="eco-champion">
                            <div class="badge-icon">üèÜ</div>
                            <div class="badge-name">Eco Champion</div>
                        </div>
                    </div>
                </div>
                
                <div class="icon-selection">
                    <h3>üé® Choose Your Profile Icon</h3>
                    <div class="icon-grid" id="icon-grid"></div>
                </div>
            </div>
        </div>
        
        <div id="login-prompt" style="display: none; text-align: center; margin-top: 50px;">
            <p style="font-size: 1.5rem; color: #555;">Please log in or sign up to view your profile and track your progress!</p>
        </div>
    </section>
    
    <section id="leaderboard" class="section" style="display: none;">
        <h2>üèÜ Eco-Quest Leaderboard</h2>
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Username</th>
                    <th>Eco-Points</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
                </tbody>
        </table>
    </section>

    <div id="gameModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGame()">&times;</span>
            <div id="gameContent"></div>
        </div>
    </div>
    
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <div id="authContent" class="auth-container">
                <div id="login-form">
                    <h3>Log In</h3>
                    <input type="text" id="login-username" placeholder="Username" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <button onclick="login()">Log In</button>
                    <p>Don't have an account? <span class="switch-auth" onclick="showSignup()">Sign Up</span></p>
                </div>
                <div id="signup-form" style="display: none;">
                    <h3>Sign Up</h3>
                    <input type="text" id="signup-username" placeholder="Username" required>
                    <input type="password" id="signup-password" placeholder="Password" required>
                    <div class="icon-selection">
                        <h4>Choose an Avatar</h4>
                        <div class="icon-grid" id="signup-icon-grid"></div>
                    </div>
                    <button onclick="signup()">Sign Up</button>
                    <p>Already have an account? <span class="switch-auth" onclick="showLogin()">Log In</span></p>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <div id="celebration" class="celebration"></div>

    <script>
        const profileIcons = ['üå≥', '‚ôªÔ∏è', '‚òÄÔ∏è', 'üêº', 'üåä', 'üå±', 'üåç', 'ü¶ã', 'üêù', 'ü¶ä', 'üêøÔ∏è', 'ü¶å', 'ü¶ú'];
        let gameState = {
            ecoPoints: 0,
            questsCompleted: 0,
            badgesEarned: 0,
            streakDays: 1,
            unlockedBadges: [],
            questProgress: {},
            username: null,
            avatar: 'üë§'
        };
        
        let users = JSON.parse(localStorage.getItem('ecoquest-users')) || {};
        let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;
        
        function loadUsers() {
            users = JSON.parse(localStorage.getItem('ecoquest-users')) || {};
        }

        function saveUsers() {
            localStorage.setItem('ecoquest-users', JSON.stringify(users));
        }

        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            if (users[username] && users[username].password === password) {
                loggedInUser = username;
                localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                gameState = users[username].state;
                updateUI();
                closeAuthModal();
                showNotification(`Welcome back, ${username}!`, 3000);
            } else {
                showNotification('Invalid username or password.', 3000);
            }
        }

        function signup() {
            const username = document.getElementById('signup-username').value;
            const password = document.getElementById('signup-password').value;
            const selectedIcon = document.querySelector('#signup-icon-grid .icon-option.selected');
            
            if (users[username]) {
                showNotification('Username already exists. Please choose another.', 3000);
                return;
            }
            
            if (username.length < 3 || password.length < 3) {
                showNotification('Username and password must be at least 3 characters.', 3000);
                return;
            }
            
            if (!selectedIcon) {
                showNotification('Please select a profile icon.', 3000);
                return;
            }

            users[username] = {
                password: password,
                state: {
                    ecoPoints: 0,
                    questsCompleted: 0,
                    badgesEarned: 0,
                    streakDays: 1,
                    unlockedBadges: [],
                    questProgress: {},
                    username: username,
                    avatar: selectedIcon.textContent
                }
            };
            saveUsers();
            showLogin();
            showNotification('Sign up successful! You can now log in.', 3000);
        }

        function logout() {
            loggedInUser = null;
            localStorage.removeItem('loggedInUser');
            gameState = {
                ecoPoints: 0,
                questsCompleted: 0,
                badgesEarned: 0,
                streakDays: 1,
                unlockedBadges: [],
                questProgress: {},
                username: null,
                avatar: 'üë§'
            };
            updateUI();
            showNotification('You have been logged out.', 3000);
            showSection('home');
        }

        function openAuthModal() {
            document.getElementById('authModal').style.display = 'block';
        }

        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
        }

        function showLogin() {
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('signup-form').style.display = 'none';
        }

        function showSignup() {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('signup-form').style.display = 'block';
            renderIconSelection('#signup-icon-grid');
        }

        function renderIconSelection(containerId) {
            const container = document.querySelector(containerId);
            container.innerHTML = '';
            profileIcons.forEach(icon => {
                const iconDiv = document.createElement('div');
                iconDiv.className = 'icon-option';
                iconDiv.textContent = icon;
                iconDiv.onclick = () => {
                    document.querySelectorAll(`${containerId} .icon-option`).forEach(el => el.classList.remove('selected'));
                    iconDiv.classList.add('selected');
                    if (loggedInUser) {
                        setProfileIcon(icon);
                    }
                };
                container.appendChild(iconDiv);
            });
            if (loggedInUser) {
                const currentIconElement = document.querySelector(`${containerId} .icon-option[data-icon="${gameState.avatar}"]`);
                if (currentIconElement) {
                    currentIconElement.classList.add('selected');
                }
            } else {
                document.querySelector(`${containerId} .icon-option`).classList.add('selected');
            }
        }
        
        function setProfileIcon(icon) {
            if (loggedInUser) {
                gameState.avatar = icon;
                saveProgress();
                updateUI();
                showNotification('Profile icon updated!', 2000);
            }
        }

        function loadProgress() {
            loadUsers();
            loggedInUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;

            if (loggedInUser && users[loggedInUser]) {
                gameState = users[loggedInUser].state;
            } else {
                const saved = localStorage.getItem('ecoquest-progress');
                if (saved) {
                    // This is for a guest state, which we are no longer using for progress.
                    // This can be kept as a fallback but the main logic is for loggedInUser.
                    gameState = { ...gameState, ...JSON.parse(saved) };
                }
            }
            updateUI();
        }

        function saveProgress() {
            if (loggedInUser) {
                users[loggedInUser].state = gameState;
                saveUsers();
            }
        }
        
        function updateUI() {
            const userDisplay = document.getElementById('user-display');
            if (loggedInUser) {
                userDisplay.innerHTML = `
                    <div class="user-info">
                        <span class="user-avatar">${gameState.avatar}</span>
                        <span>üëã Hi, ${loggedInUser}</span>
                        <span>üåü ${gameState.ecoPoints}</span>
                        <a href="#" style="text-decoration: none; color: white;" onclick="logout()">üö™ Logout</a>
                    </div>
                `;
            } else {
                userDisplay.innerHTML = `
                    <a href="#" class="user-stats" onclick="openAuthModal()">
                        <span>üë§ Login/Sign Up</span>
                    </a>
                `;
            }

            // Update the profile section visibility
            const profileContent = document.getElementById('profile-content');
            const loginPrompt = document.getElementById('login-prompt');
            if (loggedInUser) {
                profileContent.style.display = 'block';
                loginPrompt.style.display = 'none';
                document.getElementById('profile-avatar').textContent = gameState.avatar;
                document.getElementById('profile-username').textContent = gameState.username;
                document.getElementById('eco-points').textContent = gameState.ecoPoints;
                document.getElementById('quests-completed').textContent = gameState.questsCompleted;
                document.getElementById('badges-earned').textContent = gameState.badgesEarned;
                document.getElementById('streak-days').textContent = gameState.streakDays;
                gameState.unlockedBadges.forEach(badgeId => {
                    const badgeElement = document.querySelector(`[data-badge="${badgeId}"]`);
                    if (badgeElement) {
                        badgeElement.classList.remove('locked');
                    }
                });
                renderIconSelection('#icon-grid');
            } else {
                profileContent.style.display = 'none';
                loginPrompt.style.display = 'block';
            }
            
            updateLeaderboard();
        }

        function updateLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboard-body');
            leaderboardBody.innerHTML = '';
            
            const allPlayers = Object.keys(users).map(username => ({
                username: username,
                points: users[username].state.ecoPoints,
                avatar: users[username].state.avatar || 'üë§'
            }));
            
            allPlayers.sort((a, b) => b.points - a.points);
            
            allPlayers.slice(0, 10).forEach((player, index) => {
                const row = document.createElement('tr');
                if (loggedInUser && player.username === loggedInUser) {
                    row.classList.add('user-rank');
                }
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><span class="user-avatar">${player.avatar}</span> ${player.username}</td>
                    <td>${player.points}</td>
                `;
                leaderboardBody.appendChild(row);
            });
            
            // Show current user's rank if not in top 10
            if (loggedInUser) {
                const userRank = allPlayers.findIndex(p => p.username === loggedInUser);
                if (userRank >= 10) {
                    const separatorRow = document.createElement('tr');
                    separatorRow.innerHTML = `<td colspan="3" style="text-align: center;">...</td>`;
                    leaderboardBody.appendChild(separatorRow);

                    const userRow = document.createElement('tr');
                    userRow.classList.add('user-rank');
                    userRow.innerHTML = `
                        <td>${userRank + 1}</td>
                        <td><span class="user-avatar">${gameState.avatar}</span> ${loggedInUser}</td>
                        <td>${gameState.ecoPoints}</td>
                    `;
                    leaderboardBody.appendChild(userRow);
                }
            }
        }
        
        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function celebrate() {
            const celebration = document.getElementById('celebration');
            const emojis = ['üéâ', 'üåü', 'üéä', 'üíö', 'üå±', 'üèÜ'];
            
            for (let i = 0; i < 20; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '0';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                celebration.appendChild(confetti);
                
                setTimeout(() => {
                    if (celebration.contains(confetti)) {
                        celebration.removeChild(confetti);
                    }
                }, 3000);
            }
        }

        function awardPoints(points, questType = null) {
            gameState.ecoPoints += points;
            
            if (questType) {
                if (!gameState.questProgress[questType]) {
                    gameState.questProgress[questType] = 0;
                }
                gameState.questProgress[questType]++;
                
                if (gameState.questProgress[questType] === 1) {
                    gameState.questsCompleted++;
                    checkForBadges(questType);
                }
            }
            
            updateUI();
            saveProgress();
            celebrate();
            showNotification(`üéâ You earned ${points} Eco-Points!`);
        }

        function checkForBadges(questType) {
            const badges = {
                'recycling': 'recycling-novice',
                'forest': 'tree-planter',
                'solar': 'energy-saver'
            };
            
            if (badges[questType] && !gameState.unlockedBadges.includes(badges[questType])) {
                gameState.unlockedBadges.push(badges[questType]);
                gameState.badgesEarned++;
                showNotification(`üèÖ New Badge Unlocked: ${badges[questType].replace('-', ' ').toUpperCase()}!`, 4000);
            }

            if (gameState.questsCompleted >= 3 && !gameState.unlockedBadges.includes('eco-champion')) {
                gameState.unlockedBadges.push('eco-champion');
                gameState.badgesEarned++;
                showNotification('üèÜ CONGRATULATIONS! You are now an ECO-CHAMPION!', 5000);
            }
        }

        function showSection(sectionId) {
            const sections = ['home', 'quests', 'learn', 'profile', 'leaderboard'];
            sections.forEach(id => {
                const section = document.getElementById(id);
                if (section) {
                    section.style.display = id === sectionId ? 'block' : 'none';
                }
            });
            
            if (sectionId === 'home') {
                document.querySelector('.hero').style.display = 'block';
            } else {
                document.querySelector('.hero').style.display = 'none';
            }
        }

        function startAdventure() {
            showSection('quests');
            showNotification('üöÄ Welcome to your eco-adventure! Choose your first mission!');
        }
        
        function checkLoginAndRedirect() {
            if (!loggedInUser) {
                showNotification('üö® You must be logged in to play missions!', 4000);
                openAuthModal();
                showLogin();
                return false;
            }
            return true;
        }

        function startRecyclingGame() {
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <div class="game-area">
                    <h2>‚ôªÔ∏è Recycling Hero Mission</h2>
                    <p>Drag each item to the correct recycling bin!</p>
                    <div class="score">Score: <span id="game-score">0</span>/6</div>
                    
                    <div class="recycling-bins">
                        <div class="bin" data-type="plastic" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="bin-icon">üóÇÔ∏è</div>
                            <div class="bin-label">Plastic</div>
                        </div>
                        <div class="bin" data-type="paper" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="bin-icon">üìÑ</div>
                            <div class="bin-label">Paper</div>
                        </div>
                        <div class="bin" data-type="glass" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="bin-icon">üç∂</div>
                            <div class="bin-label">Glass</div>
                        </div>
                        <div class="bin" data-type="organic" ondrop="drop(event)" ondragover="allowDrop(event)">
                            <div class="bin-icon">ü•¨</div>
                            <div class="bin-label">Organic</div>
                        </div>
                    </div>
                    
                    <div class="draggable-items">
                        <div class="draggable-item" draggable="true" data-type="plastic" ondragstart="drag(event)">ü•§</div>
                        <div class="draggable-item" draggable="true" data-type="paper" ondragstart="drag(event)">üì∞</div>
                        <div class="draggable-item" draggable="true" data-type="glass" ondragstart="drag(event)">üç∫</div>
                        <div class="draggable-item" draggable="true" data-type="organic" ondragstart="drag(event)">üçå</div>
                        <div class="draggable-item" draggable="true" data-type="plastic" ondragstart="drag(event)">üß¥</div>
                        <div class="draggable-item" draggable="true" data-type="paper" ondragstart="drag(event)">üì¶</div>
                    </div>
                    
                    <div id="game-feedback"></div>
                </div>
            `;
            
            document.getElementById('gameModal').style.display = 'block';
            window.currentGame = 'recycling';
            window.gameScore = 0;
        }

        function startForestGame() {
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <div class="game-area">
                    <h2>üå≥ Forest Guardian Mission</h2>
                    <p>Click on empty spaces to plant trees and protect the forest!</p>
                    <div class="score">Trees Planted: <span id="game-score">0</span>/10</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(5, 60px); gap: 10px; justify-content: center; margin: 2rem 0;">
                        ${Array.from({length: 25}, (_, i) => 
                            `<div class="forest-cell" data-index="${i}" onclick="plantTree(${i})" 
                                 style="width: 60px; height: 60px; border: 2px solid #8BC34A; border-radius: 10px; 
                                        display: flex; align-items: center; justify-content: center; cursor: pointer; 
                                        background: linear-gradient(145deg, #E8F5E8, #C8E6C9); font-size: 1.5rem;">
                                ${Math.random() > 0.7 ? 'üå±' : ''}
                            </div>`
                        ).join('')}
                    </div>
                    
                    <div id="game-feedback"></div>
                </div>
            `;
            
            document.getElementById('gameModal').style.display = 'block';
            window.currentGame = 'forest';
            window.gameScore = 0;
            window.treesPlanted = 0;
        }

        function startSolarGame() {
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <div class="game-area">
                    <h2>‚òÄÔ∏è Solar City Builder</h2>
                    <p>Connect solar panels to power the city buildings!</p>
                    <div class="score">Buildings Powered: <span id="game-score">0</span>/6</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(4, 80px); gap: 15px; justify-content: center; margin: 2rem 0;">
                        <div class="solar-panel" onclick="toggleSolar(0)" data-index="0" style="width: 80px; height: 60px; background: #FFE082; border: 2px solid #FFC107; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem;">‚òÄÔ∏è</div>
                        <div class="building unpowered" data-index="1" style="width: 80px; height: 60px; background: #FFCDD2; border: 2px solid #F44336; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">üè†</div>
                        <div class="building unpowered" data-index="2" style="width: 80px; height: 60px; background: #FFCDD2; border: 2px solid #F44336; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">üè¢</div>
                        <div class="solar-panel" onclick="toggleSolar(3)" data-index="3" style="width: 80px; height: 60px; background: #FFE082; border: 2px solid #FFC107; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem;">‚òÄÔ∏è</div>
                        
                        <div class="building unpowered" data-index="4" style="width: 80px; height: 60px; background: #FFCDD2; border: 2px solid #F44336; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">üè™</div>
                        <div class="solar-panel" onclick="toggleSolar(5)" data-index="5" style="width: 80px; height: 60px; background: #FFE082; border: 2px solid #FFC107; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem;">‚òÄÔ∏è</div>
                        <div class="solar-panel" onclick="toggleSolar(6)" data-index="6" style="width: 80px; height: 60px; background: #FFE082; border: 2px solid #FFC107; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem;">‚òÄÔ∏è</div>
                        <div class="building unpowered" data-index="7" style="width: 80px; height: 60px; background: #FFCDD2; border: 2px solid #F44336; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">üè´</div>
                        
                        <div class="building unpowered" data-index="8" style="width: 80px; height: 60px; background: #FFCDD2; border: 2px solid #F44336; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">üè≠</div>
                        <div class="building unpowered" data-index="9" style="width: 80px; height: 60px; background: #FFCDD2; border: 2px solid #F44336; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem;">üè•</div>
                        <div class="solar-panel" onclick="toggleSolar(10)" data-index="10" style="width: 80px; height: 60px; background: #FFE082; border: 2px solid #FFC107; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem;">‚òÄÔ∏è</div>
                        <div class="solar-panel" onclick="toggleSolar(11)" data-index="11" style="width: 80px; height: 60px; background: #FFE082; border: 2px solid #FFC107; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem;">‚òÄÔ∏è</div>
                    </div>
                    
                    <p style="margin-top: 1rem; color: #666;">üí° Click on solar panels to activate them and power nearby buildings!</p>
                    <div id="game-feedback"></div>
                </div>
            `;
            
            document.getElementById('gameModal').style.display = 'block';
            window.currentGame = 'solar';
            window.gameScore = 0;
            window.activePanels = new Set();
        }

        function closeGame() {
            document.getElementById('gameModal').style.display = 'none';
        }

        function allowDrop(ev) {
            ev.preventDefault();
            ev.target.closest('.bin').classList.add('highlight');
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.dataset.type);
            ev.target.classList.add('dragging');
        }

        function drop(ev) {
            ev.preventDefault();
            const itemType = ev.dataTransfer.getData("text");
            const binType = ev.target.closest('.bin').dataset.type;
            const bin = ev.target.closest('.bin');
            
            bin.classList.remove('highlight');
            
            if (itemType === binType) {
                window.gameScore++;
                document.getElementById('game-score').textContent = window.gameScore;
                
                const draggedItems = document.querySelectorAll('.draggable-item.dragging');
                draggedItems.forEach(item => item.remove());
                
                bin.classList.add('success-animation');
                setTimeout(() => bin.classList.remove('success-animation'), 500);
                
                document.getElementById('game-feedback').innerHTML = 
                    `<p style="color: #4CAF50; font-weight: bold;">‚úÖ Correct! Great job!</p>`;
                
                if (window.gameScore >= 6) {
                    setTimeout(() => {
                        document.getElementById('game-feedback').innerHTML = 
                            `<p style="color: #4CAF50; font-weight: bold; font-size: 1.2rem;">üéâ Mission Complete! You're a Recycling Hero!</p>`;
                        awardPoints(100, 'recycling');
                        setTimeout(closeGame, 3000);
                    }, 1000);
                }
            } else {
                document.getElementById('game-feedback').innerHTML = 
                    `<p style="color: #f44336; font-weight: bold;">‚ùå Try again! This doesn't belong here.</p>`;
            }
            
            document.querySelectorAll('.draggable-item').forEach(item => 
                item.classList.remove('dragging'));
        }

        function plantTree(index) {
            const cell = document.querySelector(`.forest-cell[data-index="${index}"]`);
            if (cell.textContent.trim() === '') {
                cell.textContent = 'üå≥';
                cell.style.background = 'linear-gradient(145deg, #C8E6C9, #A5D6A7)';
                window.treesPlanted++;
                document.getElementById('game-score').textContent = window.treesPlanted;
                
                document.getElementById('game-feedback').innerHTML = 
                    `<p style="color: #4CAF50; font-weight: bold;">üå≥ Tree planted successfully!</p>`;
                
                if (window.treesPlanted >= 10) {
                    setTimeout(() => {
                        document.getElementById('game-feedback').innerHTML = 
                            `<p style="color: #4CAF50; font-weight: bold; font-size: 1.2rem;">üéâ Forest Protected! You're a true Guardian!</p>`;
                        awardPoints(150, 'forest');
                        setTimeout(closeGame, 3000);
                    }, 1000);
                }
            } else {
                document.getElementById('game-feedback').innerHTML = 
                    `<p style="color: #f44336; font-weight: bold;">‚ùå There's already something here!</p>`;
            }
        }

        function toggleSolar(index) {
            const panel = document.querySelector(`[data-index="${index}"]`);
            if (panel.classList.contains('solar-panel')) {
                if (window.activePanels.has(index)) {
                    window.activePanels.delete(index);
                    panel.style.background = '#FFE082';
                    panel.style.boxShadow = 'none';
                } else {
                    window.activePanels.add(index);
                    panel.style.background = 'linear-gradient(45deg, #FFD54F, #FFC107)';
                    panel.style.boxShadow = '0 0 20px rgba(255, 193, 7, 0.6)';
                }
                updatePoweredBuildings();
            }
        }

        function updatePoweredBuildings() {
            const buildings = document.querySelectorAll('.building');
            let poweredCount = 0;
            
            buildings.forEach((building, i) => {
                const buildingIndex = parseInt(building.dataset.index);
                const adjacentPanels = getAdjacentPanels(buildingIndex);
                const isPowered = adjacentPanels.some(panelIndex => window.activePanels.has(panelIndex));
                
                if (isPowered) {
                    building.style.background = 'linear-gradient(145deg, #C8E6C9, #A5D6A7)';
                    building.style.borderColor = '#4CAF50';
                    building.classList.remove('unpowered');
                    poweredCount++;
                } else {
                    building.style.background = '#FFCDD2';
                    building.style.borderColor = '#F44336';
                    building.classList.add('unpowered');
                }
            });
            
            window.gameScore = poweredCount;
            document.getElementById('game-score').textContent = window.gameScore;
            
            if (poweredCount >= 6) {
                setTimeout(() => {
                    document.getElementById('game-feedback').innerHTML = 
                        `<p style="color: #4CAF50; font-weight: bold; font-size: 1.2rem;">üéâ City Fully Powered! You're a Solar Champion!</p>`;
                    awardPoints(200, 'solar');
                    setTimeout(closeGame, 3000);
                }, 1000);
            }
        }

        function getAdjacentPanels(buildingIndex) {
            const adjacency = {
                1: [0, 5], 2: [0, 3, 5, 6], 4: [0, 5], 7: [3, 6, 10, 11],
                8: [5, 10], 9: [6, 10, 11]
            };
            return adjacency[buildingIndex] || [];
        }

        function showLearningContent(title, content) {
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `
                <div class="learning-content">
                    <h3>${title}</h3>
                    ${content}
                </div>
            `;
            document.getElementById('gameModal').style.display = 'block';
        }

        function showClimateChangeInfo() {
            const content = `
                <p>Climate change refers to significant and long-term changes in the Earth's weather patterns and average temperatures. While the Earth's climate has always changed, the current rate of change is much faster and is primarily caused by human activities.</p>
                <h4>What Causes It?</h4>
                <ul>
                    <li><strong>Fossil Fuels:</strong> Burning coal, oil, and gas for energy releases greenhouse gases like carbon dioxide (CO2) into the atmosphere.</li>
                    <li><strong>Deforestation:</strong> Trees absorb CO2, so clearing forests reduces the planet's ability to naturally regulate the climate.</li>
                    <li><strong>Industrial Activities:</strong> Many industrial processes release powerful greenhouse gases.</li>
                </ul>
                <h4>How Can You Help?</h4>
                <p>Every small action counts! You can help by:</p>
                <ul>
                    <li>Using less energy at home.</li>
                    <li>Choosing public transport, biking, or walking.</li>
                    <li>Reducing, reusing, and recycling waste.</li>
                    <li>Planting trees! üå≥</li>
                </ul>
            `;
            showLearningContent('üåç Climate Change Basics', content);
        }

        function showWildlifeInfo() {
            const content = `
                <p>Wildlife conservation is the practice of protecting wild animal and plant species and their habitats. It aims to prevent species from going extinct and to ensure that nature's ecosystems are healthy and functioning.</p>
                <h4>Why is it Important?</h4>
                <ul>
                    <li><strong>Ecosystem Balance:</strong> Every species plays a unique role. Losing one can disrupt the entire ecosystem.</li>
                    <li><strong>Biodiversity:</strong> A wide variety of life forms keeps our planet resilient and healthy.</li>
                    <li><strong>Human Well-being:</strong> We rely on healthy ecosystems for clean air, water, and food.</li>
                </ul>
                <h4>How Can You Help?</h4>
                <p>You can become a wildlife friend by:</p>
                <ul>
                    <li>Supporting conservation organizations.</li>
                    <li>Reducing your carbon footprint.</li>
                    <li>Choosing sustainable products that don't harm wildlife.</li>
                    <li>Not littering! Clean up after yourself to protect animal habitats.</li>
                </ul>
            `;
            showLearningContent('üêº Wildlife Conservation', content);
        }

        function showOceanInfo() {
            const content = `
                <p>The ocean is a vast and vital part of our planet, producing most of the world's oxygen and regulating our climate. However, it is under threat from pollution, overfishing, and climate change.</p>
                <h4>Major Threats to Oceans</h4>
                <ul>
                    <li><strong>Plastic Pollution:</strong> Plastic waste harms and kills marine life and pollutes beaches.</li>
                    <li><strong>Ocean Acidification:</strong> The ocean absorbs CO2, which makes it more acidic and threatens coral reefs and shellfish.</li>
                    <li><strong>Oil Spills:</strong> Accidental oil spills cause catastrophic damage to marine ecosystems.</li>
                </ul>
                <h4>How Can You Help?</h4>
                <p>Protecting our oceans starts with you:</p>
                <ul>
                    <li>Reduce your use of single-use plastics (bottles, bags, straws).</li>
                    <li>Participate in a beach or river cleanup.</li>
                    <li>Choose sustainably sourced seafood.</li>
                    <li>Educate others about the importance of our oceans.</li>
                </ul>
            `;
            showLearningContent('üåä Ocean Protection', content);
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            
            setTimeout(() => {
                const floatingContainer = document.querySelector('.floating-elements');
                const newElements = ['ü¶ã', 'üêù', 'üå∫', 'üå∏'];
                newElements.forEach((emoji, index) => {
                    const element = document.createElement('div');
                    element.className = 'leaf';
                    element.textContent = emoji;
                    element.style.left = Math.random() * 80 + '%';
                    element.style.top = Math.random() * 80 + '%';
                    element.style.animationDelay = index * 1.5 + 's';
                    floatingContainer.appendChild(element);
                });
            }, 2000);
            
            if (loggedInUser) {
                showNotification(`Welcome back, ${loggedInUser}!`, 4000);
            } else if (localStorage.getItem('ecoquest-progress') === null) {
                setTimeout(() => {
                    showNotification('üå± Welcome to Eco-Quest! Start your green adventure today!', 4000);
                }, 1000);
            }
        });

        document.addEventListener('dragend', function() {
            document.querySelectorAll('.bin').forEach(bin => {
                bin.classList.remove('highlight');
            });
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeGame();
                closeAuthModal();
            }
        });
    </script>
</body>
</html>
