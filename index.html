<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eco-Quest üå± - Save Our Planet!</title>
    <style>
        /* General Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2d5016;
            overflow-x: hidden;
        }

        /* Floating Elements (Background) */
        .floating-elements {
            position: fixed;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .leaf, .cloud, .star {
            position: absolute;
            animation: float 6s ease-in-out infinite;
        }

        .leaf {
            font-size: 24px;
            color: #4CAF50;
            animation-delay: 0s;
        }

        .cloud {
            font-size: 32px;
            color: rgba(255, 255, 255, 0.7);
            animation-delay: -2s;
        }

        .star {
            font-size: 16px;
            color: #FFD700;
            animation-delay: -4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        /* Header and Navigation */
        header {
            background: linear-gradient(135deg, #2E8B57, #228B22);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: "üåç";
            animation: spin 4s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 1.5rem; /* Reduced gap for one more item */
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        nav a:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        /* User Info/Stats in Header */
        .user-info, .user-stats {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            font-size: 1.5rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            /* Placeholder for repeating tree pattern */
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="trees" patternUnits="userSpaceOnUse" width="20" height="20"><text x="2" y="15" font-size="12" fill="rgba(255,255,255,0.1)">üå≤</text></pattern></defs><rect width="100" height="100" fill="url(%23trees)"/></svg>');
            opacity: 0.3;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .cta-button {
            background: linear-gradient(45deg, #FF6B35, #F7931E);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .cta-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .cta-button:active {
            transform: translateY(-1px) scale(1.02);
        }

        /* Section Layouts */
        .section {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: #2E7D32;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .quest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .quest-card {
            background: linear-gradient(145deg, #ffffff, #f0f8f0);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 3px solid #E8F5E8;
        }

        .quest-card::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .quest-card:hover::before {
            opacity: 1;
        }

        .quest-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-color: #4CAF50;
        }

        .quest-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 1rem;
            display: block;
        }

        .quest-card h3 {
            color: #2E7D32;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .quest-card p {
            color: #555;
            margin-bottom: 1.5rem;
            text-align: center;
            line-height: 1.6;
        }

        .quest-button {
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .difficulty {
            display: inline-block;
            background: #FFE082;
            color: #F57F17;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        /* Profile Styles */
        .profile-container {
            background: linear-gradient(145deg, #ffffff, #f0f8f0);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .profile-avatar-large {
            font-size: 5rem;
            text-align: center;
            margin-bottom: 1rem;
        }
        .profile-username {
            font-size: 2rem;
            text-align: center;
            font-weight: bold;
            color: #2E7D32;
        }

        /* Modals and Games */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(145deg, #ffffff, #f0f8f0);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        /* Game specific styles (Recycling Game) */
        .recycling-bins {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .bin {
            width: 100px;
            height: 120px;
            border: 3px dashed #ccc;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .draggable-item {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 1rem;
            cursor: grab;
            transition: all 0.3s ease;
            font-size: 1.5rem;
            min-width: 60px;
            text-align: center;
        }

        /* Notification Styling */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #4CAF50, #81C784);
            color: white;
            padding: 1rem 2rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(300px);
            transition: transform 0.3s ease;
            z-index: 1001;
        }

        .notification.show {
            transform: translateX(0);
        }
        
        /* Community Hub Styles */
        .community-post {
            background: #ffffff;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            border-left: 5px solid #4CAF50;
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 0.8rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
        }

        .post-avatar {
            font-size: 1.5rem;
        }

        .post-username {
            font-weight: bold;
            color: #2E7D32;
        }

        .post-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 1rem;
            word-wrap: break-word;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #888;
        }

        .like-button {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-weight: bold;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .like-button:hover {
            color: #FF6B35;
        }

        .like-button.liked {
            color: #FF6B35;
        }
        /* End Community Hub Styles */

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .quest-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="floating-elements">
        <div class="leaf" style="left: 10%; top: 20%;">üçÉ</div>
        <div class="cloud" style="left: 80%; top: 15%;">‚òÅÔ∏è</div>
        <div class="leaf" style="left: 70%; top: 60%;">üåø</div>
        <div class="star" style="left: 20%; top: 70%;">‚≠ê</div>
        <div class="cloud" style="left: 40%; top: 80%;">‚òÅÔ∏è</div>
        <div class="leaf" style="left: 90%; top: 40%;">üçÉ</div>
    </div>

    <header>
        <div class="nav-container">
            <div class="logo">Eco-Quest</div>
            <nav>
                <ul>
                    <li><a href="#home" onclick="showSection('home')">üè† Home</a></li>
                    <li><a href="#quests" onclick="showSection('quests')">üéÆ Quests</a></li>
                    <li><a href="#learn" onclick="showSection('learn')">üìö Learn</a></li>
                    <li><a href="#community" onclick="showSection('community')">üì£ Community</a></li>
                    <li><a href="#levels" onclick="showSection('levels')">üéì Levels</a></li>
                    <li><a href="#profile" onclick="showSection('profile')">üë§ Profile</a></li>
                    <li><a href="#leaderboard" onclick="showSection('leaderboard')">üèÜ Leaderboard</a></li>
                </ul>
            </nav>
            <div id="user-display">
                <a href="#" class="user-stats" onclick="openAuthModal()">
                    <span>üë§ Login/Sign Up</span>
                </a>
            </div>
        </div>
    </header>

    <section id="home" class="hero">
        <div class="hero-content">
            <h1>üå± Welcome to Eco-Quest! üå±</h1>
            <p>Join the adventure to save our planet! Learn about nature, sustainability, and environmental protection through fun interactive quests and games.</p>
            <button class="cta-button" onclick="startAdventure()">
                üöÄ Start Your Green Adventure!
            </button>
        </div>
    </section>

    <section id="levels" class="section" style="display: none;">
        <h2>üéì Select Your Class Level</h2>
        <div class="quest-grid">
            <div class="quest-card">
                <div class="difficulty">1st ‚Äì 3rd Class</div>
                <div class="quest-icon">üå±</div>
                <h3>Beginner Explorers</h3>
                <p>Fun and simple activities to start your green journey.</p>
                <button class="quest-button" onclick="selectLevel('level_1_3')">Select Level</button>
            </div>
            <div class="quest-card">
                <div class="difficulty">4th ‚Äì 6th Class</div>
                <div class="quest-icon">üåø</div>
                <h3>Eco Learners</h3>
                <p>Explore recycling, trees, and nature with exciting missions.</p>
                <div style="text-align:center; color:#888; font-weight:bold; margin-top:1rem;">Games for this level are under progress.</div>
            </div>
            <div class="quest-card">
                <div class="difficulty">7th ‚Äì 9th Class</div>
                <div class="quest-icon">üå≥</div>
                <h3>Green Guardians</h3>
                <p>Dive deeper into conservation and renewable energy.</p>
                <div style="text-align:center; color:#888; font-weight:bold; margin-top:1rem;">Games for this level are under progress.</div>
            </div>
            <div class="quest-card">
                <div class="difficulty">10th ‚Äì 12th Class</div>
                <div class="quest-icon">‚òÄÔ∏è</div>
                <h3>Eco Champions</h3>
                <p>Advanced challenges focusing on sustainable cities and climate.</p>
                <div style="text-align:center; color:#888; font-weight:bold; margin-top:1rem;">Games for this level are under progress.</div>
            </div>
        </div>
        <p style="text-align:center; color:#555;">Your selection will personalize recommendations without removing any features.</p>
    </section>

    <section id="quests" class="section" style="display: none;">
        <h2>üéØ Your Eco-Missions</h2>
        <div class="quest-grid">
            <div class="quest-card">
                <div class="difficulty">‚≠ê Beginner</div>
                <div class="quest-icon">‚ôªÔ∏è</div>
                <h3>Recycling Hero</h3>
                <p>Learn to sort different types of waste into the correct recycling bins. Help reduce pollution and save our planet!</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 0%">0%</div>
                </div>
                <button class="quest-button" onclick="if (checkLoginAndRedirect()) { startRecyclingGame(); }">Start Mission</button>
            </div>
            
            <div class="quest-card">
                <div class="difficulty">‚≠ê‚≠ê Intermediate</div>
                <div class="quest-icon">üå≥</div>
                <h3>Forest Guardian</h3>
                <p>Protect the rainforest by planting trees and learning about wildlife conservation. Every tree counts!</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 0%">0%</div>
                </div>
                <button class="quest-button" onclick="if (checkLoginAndRedirect()) { startForestGame(); }">Start Mission</button>
            </div>
            
            <div class="quest-card">
                <div class="difficulty">‚≠ê‚≠ê‚≠ê Advanced</div>
                <div class="quest-icon">‚òÄÔ∏è</div>
                <h3>Solar City Builder</h3>
                <p>Design and build a sustainable city powered entirely by renewable energy sources!</p>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 0%">0%</div>
                </div>
                <button class="quest-button" onclick="if (checkLoginAndRedirect()) { startSolarGame(); }">Start Mission</button>
            </div>
        </div>
    </section>

    <section id="learn" class="section" style="display: none;">
        <h2>üìñ Environmental Knowledge Hub</h2>
        <div class="quest-grid">
            <div class="quest-card">
                <div class="quest-icon">üåç</div>
                <h3>Climate Change Basics</h3>
                <p>Discover what climate change is and how it affects our planet.</p>
                <button class="quest-button" onclick="showClimateChangeInfo()">Learn More</button>
            </div>
            
            <div class="quest-card">
                <div class="quest-icon">üêº</div>
                <h3>Wildlife Conservation</h3>
                <p>Learn about endangered species and how we can protect them.</p>
                <button class="quest-button" onclick="showWildlifeInfo()">Learn More</button>
            </div>
            
            <div class="quest-card">
                <div class="quest-icon">üåä</div>
                <h3>Ocean Protection</h3>
                <p>Understand ocean pollution and marine ecosystem protection.</p>
                <button class="quest-button" onclick="showOceanInfo()">Learn More</button>
            </div>
        </div>
    </section>

    <section id="community" class="section" style="display: none;">
        <h2>üó£Ô∏è Eco-Community Hub</h2>
        <div id="community-post-form" style="margin-bottom: 2rem; background: #E8F5E8; padding: 1.5rem; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
            <h3>Share Your Eco-Thoughts!</h3>
            <textarea id="post-input" placeholder="What green thing are you doing today? (Max 200 chars)" maxlength="200" style="width: 100%; padding: 0.8rem; border-radius: 10px; border: 1px solid #ccc; resize: vertical; margin: 10px 0; font-family: 'Comic Sans MS', cursive, sans-serif; min-height: 80px;"></textarea>
            <button class="cta-button" style="width: 100%;" onclick="submitPost()">Post to Community</button>
        </div>
        <div id="community-posts-container">
            <p style="text-align: center; color: #777;">Loading community posts...</p>
        </div>
    </section>

    <section id="profile" class="section" style="display: none;">
        <h2>üèÜ Your Eco-Profile</h2>
        <div id="profile-content">
            <div class="profile-container">
                <div class="profile-avatar-large" id="profile-avatar">üë§</div>
                <div class="profile-username" id="profile-username">Guest</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="eco-points">0</div>
                        <div class="stat-label">üåü Eco-Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="quests-completed">0</div>
                        <div class="stat-label">‚úÖ Quests Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="badges-earned">0</div>
                        <div class="stat-label">üèÖ Badges Earned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="streak-days">0</div>
                        <div class="stat-label">üî• Day Streak</div>
                    </div>
                </div>
                
                <div class="badges-container">
                    <h3>üèÖ Your Eco-Badges</h3>
                    <div class="badges-grid">
                        <div class="badge locked" data-badge="recycling-novice">
                            <div class="badge-icon">‚ôªÔ∏è</div>
                            <div class="badge-name">Recycling Novice</div>
                        </div>
                        <div class="badge locked" data-badge="tree-planter">
                            <div class="badge-icon">üå≥</div>
                            <div class="badge-name">Tree Planter</div>
                        </div>
                        <div class="badge locked" data-badge="energy-saver">
                            <div class="badge-icon">‚ö°</div>
                            <div class="badge-name">Energy Saver</div>
                        </div>
                        <div class="badge locked" data-badge="ocean-protector">
                            <div class="badge-icon">üåä</div>
                            <div class="badge-name">Ocean Protector</div>
                        </div>
                        <div class="badge locked" data-badge="wildlife-friend">
                            <div class="badge-icon">üêº</div>
                            <div class="badge-name">Wildlife Friend</div>
                        </div>
                        <div class="badge locked" data-badge="eco-champion">
                            <div class="badge-icon">üèÜ</div>
                            <div class="badge-name">Eco Champion</div>
                        </div>
                    </div>
                </div>

                <div class="icon-selection">
                    <h3>üé® Choose Your Profile Icon</h3>
                    <div class="icon-grid" id="icon-grid"></div>
                </div>
            </div>
        </div>
        <div id="login-prompt" style="display: none; text-align: center; margin-top: 50px;">
            <p style="font-size: 1.5rem; color: #555;">Please log in or sign up to view your profile and track your progress!</p>
        </div>
    </section>

    <section id="leaderboard" class="section" style="display: none;">
        <h2>üèÜ Eco-Quest Leaderboard</h2>
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Username</th>
                    <th>Eco-Points</th>
                </tr>
            </thead>
            <tbody id="leaderboard-body">
            </tbody>
        </table>
    </section>

    <div id="gameModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeGame()">&times;</span> 
            <div id="gameContent"></div>
        </div>
    </div>

    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <div id="authContent" class="auth-container">
                <div id="login-form">
                    <h3>Log In</h3>
                    <input type="text" id="login-username" placeholder="Username" required>
                    <input type="password" id="login-password" placeholder="Password" required>
                    <label for="login-class" style="margin-top: 0.5rem; color:#2E7D32; font-weight:bold;">Class Level (optional)</label>
                    <select id="login-class">
                        <option value="">Select class level (optional)</option>
                        <option value="level_1_3">üå± 1st‚Äì3rd Class</option>
                        <option value="level_4_6">üåø 4th‚Äì6th Class</option>
                        <option value="level_7_9">üå≥ 7th‚Äì9th Class</option>
                        <option value="level_10_12">‚òÄÔ∏è 10th‚Äì12th Class</option>
                    </select>
                    <button onclick="login()">Log In</button>
                    <p>Don't have an account? <span class="switch-auth" onclick="showSignup()">Sign Up</span></p>
                </div>
                <div id="signup-form" style="display: none;">
                    <h3>Sign Up</h3>
                    <input type="text" id="signup-username" placeholder="Username" required>
                    <input type="password" id="signup-password" placeholder="Password" required>
                    <label for="signup-class" style="margin-top: 0.5rem; color:#2E7D32; font-weight:bold;">Select Your Class Level</label>
                    <select id="signup-class" required>
                        <option value="">Select your class level</option>
                        <option value="level_1_3">üå± 1st‚Äì3rd Class</option>
                        <option value="level_4_6">üåø 4th‚Äì6th Class</option>
                        <option value="level_7_9">üå≥ 7th‚Äì9th Class</option>
                        <option value="level_10_12">‚òÄÔ∏è 10th‚Äì12th Class</option>
                    </select>
                    <div class="icon-selection">
                        <h4>Choose an Avatar</h4>
                        <div class="icon-grid" id="signup-icon-grid"></div>
                    </div>
                    <button onclick="signup()">Sign Up</button>
                    <p>Already have an account? <span class="switch-auth" onclick="showLogin()">Log In</span></p>
                </div>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>
    <div id="celebration" class="celebration"></div>

    <script>
        const profileIcons = ['üå≥', '‚ôªÔ∏è', '‚òÄÔ∏è', 'üêº', 'üåä', 'üå±', 'üåç', 'ü¶ã', 'üêù', 'ü¶ä', 'üêøÔ∏è', 'ü¶å', 'ü¶ú'];
        
        // --- State Management ---
        let gameState = {
            ecoPoints: 0,
            questsCompleted: 0,
            badgesEarned: 0,
            streakDays: 1,
            unlockedBadges: [],
            questProgress: {
                'Recycling Hero': 0 // Example progress
            },
            username: null,
            avatar: 'üë§',
            selectedLevel: null
        };
        let users = JSON.parse(localStorage.getItem('ecoquest-users')) || {};
        let loggedInUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;
        let communityPosts = JSON.parse(localStorage.getItem('ecoquest-posts')) || [];

        function loadUsers() {
            users = JSON.parse(localStorage.getItem('ecoquest-users')) || {};
        }

        function saveUsers() {
            localStorage.setItem('ecoquest-users', JSON.stringify(users));
        }

        function saveProgress() {
            if (loggedInUser) {
                users[loggedInUser].state = gameState;
                saveUsers();
            }
        }
        
        function loadProgress() {
            loadUsers();
            loggedInUser = JSON.parse(localStorage.getItem('loggedInUser')) || null;
            if (loggedInUser && users[loggedInUser]) {
                gameState = users[loggedInUser].state;
            } else {
                // Reset to guest state if not logged in
                gameState = {
                    ecoPoints: 0,
                    questsCompleted: 0,
                    badgesEarned: 0,
                    streakDays: 1,
                    unlockedBadges: [],
                    questProgress: {},
                    username: null,
                    avatar: 'üë§',
                    selectedLevel: null
                };
            }
            updateUI();
        }

        // --- Core UI Functions (FIXED/COMPLETED) ---

        /** * FIX: Implemented showNotification function. 
         */
        function showNotification(message, duration = 3000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        function updateUI() {
            const userDisplay = document.getElementById('user-display');
            
            if (loggedInUser) {
                userDisplay.innerHTML = `
                    <div class="user-info">
                        <span class="user-avatar">${gameState.avatar}</span>
                        <span>üëã Hi, ${loggedInUser}</span>
                        <span>üåü ${gameState.ecoPoints}</span>
                        ${gameState.selectedLevel ? `<span class="difficulty" style="background:#E3F2FD;color:#1565C0;">${getSelectedLevelLabel()}</span>` : ''}
                        <a href="#" style="text-decoration: none; color: white;" onclick="logout()">üö™ Logout</a>
                    </div>
                `;
                // Update profile section
                document.getElementById('profile-avatar').textContent = gameState.avatar;
                document.getElementById('profile-username').textContent = gameState.username;
                document.getElementById('eco-points').textContent = gameState.ecoPoints;
                document.getElementById('quests-completed').textContent = gameState.questsCompleted;
                document.getElementById('badges-earned').textContent = gameState.badgesEarned;
                document.getElementById('streak-days').textContent = gameState.streakDays;
                document.getElementById('profile-content').style.display = 'block';
                document.getElementById('login-prompt').style.display = 'none';

                // Update badges
                document.querySelectorAll('.badge').forEach(badgeEl => {
                    const badgeKey = badgeEl.getAttribute('data-badge');
                    if (gameState.unlockedBadges.includes(badgeKey)) {
                        badgeEl.classList.remove('locked');
                    } else {
                        badgeEl.classList.add('locked');
                    }
                });

            } else {
                userDisplay.innerHTML = `
                    <a href="#" class="user-stats" onclick="openAuthModal()">
                        <span>üë§ Login/Sign Up</span>
                    </a>
                `;
                document.getElementById('profile-content').style.display = 'none';
                document.getElementById('login-prompt').style.display = 'block';
            }
            
            // Update quest progress bars
            for (const quest in gameState.questProgress) {
                const questEl = document.querySelector(`.quest-card h3:contains('${quest}')`).closest('.quest-card');
                if (questEl) {
                    const progressBar = questEl.querySelector('.progress-bar');
                    const progress = gameState.questProgress[quest];
                    progressBar.style.width = `${progress}%`;
                    progressBar.textContent = `${progress}%`;
                }
            }

            renderLeaderboard();
        }

        /**
         * FIX: showSection logic updated to handle new Community section and dynamic rendering.
         */
        function showSection(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';

            if (sectionId === 'profile') {
                updateUI(); // Ensure profile data is fresh
                renderIconSelection('#icon-grid'); // Render icon selector for changing avatar
            } else if (sectionId === 'leaderboard') {
                renderLeaderboard();
            } else if (sectionId === 'community') {
                renderCommunityPosts();
            }
            // Navigate to the section hash in the URL for better user experience
            history.pushState(null, '', `#${sectionId}`);
        }

        /**
         * FIX: checkLoginAndRedirect function implemented fully.
         */
        function checkLoginAndRedirect() {
            if (!loggedInUser) {
                showNotification('You must be logged in to start a mission!', 3000);
                openAuthModal();
                return false;
            }
            return true;
        }

        /**
         * FIX: startAdventure function implemented as a guide.
         */
        function startAdventure() {
            showNotification('Adventure starts now! Head over to the Quests tab to begin your first mission! üéÆ', 4000);
            showSection('quests');
        }

        // --- Authentication & Profile Functions ---
        // (These were mostly correct but now rely on the fixed showNotification/updateUI)

        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const loginSelectedLevel = document.getElementById('login-class').value;

            if (users[username] && users[username].password === password) {
                loggedInUser = username;
                localStorage.setItem('loggedInUser', JSON.stringify(loggedInUser));
                gameState = users[username].state;
                if (loginSelectedLevel) {
                    gameState.selectedLevel = loginSelectedLevel;
                    saveProgress();
                }
                updateUI();
                closeAuthModal();
                showNotification(`Welcome back, ${username}!`, 3000);
            } else {
                showNotification('Invalid username or password.', 3000);
            }
        }

        function signup() {
            const username = document.getElementById('signup-username').value;
            const password = document.getElementById('signup-password').value;
            const selectedIcon = document.querySelector('#signup-icon-grid .icon-option.selected');
            const signupSelectedLevel = document.getElementById('signup-class').value;

            if (users[username]) {
                showNotification('Username already exists. Please choose another.', 3000);
                return;
            }
            if (username.length < 3 || password.length < 3) {
                showNotification('Username and password must be at least 3 characters.', 3000);
                return;
            }
            if (!selectedIcon) {
                showNotification('Please select a profile icon.', 3000);
                return;
            }
            if (!signupSelectedLevel) {
                showNotification('Please select your class level.', 3000);
                return;
            }

            users[username] = {
                password: password,
                state: {
                    ecoPoints: 0,
                    questsCompleted: 0,
                    badgesEarned: 0,
                    streakDays: 1,
                    unlockedBadges: [],
                    questProgress: {},
                    username: username,
                    avatar: selectedIcon.textContent,
                    selectedLevel: signupSelectedLevel
                }
            };
            saveUsers();
            showLogin();
            showNotification('Sign up successful! You can now log in.', 3000);
        }

        function logout() {
            loggedInUser = null;
            localStorage.removeItem('loggedInUser');
            loadProgress(); // Reset to default guest state
            updateUI();
            showNotification('You have been logged out.', 3000);
            showSection('home');
        }

        function openAuthModal() { document.getElementById('authModal').style.display = 'block'; }
        function closeAuthModal() { document.getElementById('authModal').style.display = 'none'; }
        function showLogin() { document.getElementById('login-form').style.display = 'block'; document.getElementById('signup-form').style.display = 'none'; }
        function showSignup() { document.getElementById('login-form').style.display = 'none'; document.getElementById('signup-form').style.display = 'block'; renderIconSelection('#signup-icon-grid'); }

        function renderIconSelection(containerId) {
            const container = document.querySelector(containerId);
            container.innerHTML = '';
            profileIcons.forEach(icon => {
                const iconDiv = document.createElement('div');
                iconDiv.className = 'icon-option';
                iconDiv.textContent = icon;
                // Add a data attribute for easier lookup
                iconDiv.setAttribute('data-icon', icon); 
                iconDiv.onclick = () => {
                    document.querySelectorAll(`${containerId} .icon-option`).forEach(el => el.classList.remove('selected'));
                    iconDiv.classList.add('selected');
                    if (loggedInUser && containerId === '#icon-grid') {
                        setProfileIcon(icon);
                    }
                };
                container.appendChild(iconDiv);
            });
            // Highlight the currently selected icon
            const currentIconElement = document.querySelector(`${containerId} .icon-option[data-icon="${gameState.avatar}"]`);
            if (currentIconElement) {
                currentIconElement.classList.add('selected');
            }
        }

        function setProfileIcon(icon) {
            if (loggedInUser) {
                gameState.avatar = icon;
                saveProgress();
                updateUI();
                showNotification('Profile icon updated!', 2000);
            }
        }

        // --- Level Functions ---
        const levelGroups = {
            'level_1_3': { name: '1st‚Äì3rd', icon: 'üå±' },
            'level_4_6': { name: '4th‚Äì6th', icon: 'üåø' },
            'level_7_9': { name: '7th‚Äì9th', icon: 'üå≥' },
            'level_10_12': { name: '10th‚Äì12th', icon: '‚òÄÔ∏è' }
        };

        function getSelectedLevelLabel() {
            if (!gameState.selectedLevel) return '';
            const lv = levelGroups[gameState.selectedLevel];
            return lv ? `${lv.icon} ${lv.name}` : '';
        }

        function selectLevel(levelKey) {
            if (!levelGroups[levelKey]) {
                showNotification('Invalid level selection.', 3000);
                return;
            }
            if (loggedInUser) {
                gameState.selectedLevel = levelKey;
                saveProgress();
                updateUI();
            } else {
                // Allow guest selection for session viewing, but prompt to login for permanent save
                gameState.selectedLevel = levelKey;
            }
            
            const label = getSelectedLevelLabel();
            showNotification(`üéì Level selected: ${label}`, 3000);
            showSection('quests');
        }

        // --- Leaderboard Functions ---

        function getLeaderboardData() {
            return Object.values(users)
                .map(user => ({
                    username: user.state.username,
                    points: user.state.ecoPoints,
                    avatar: user.state.avatar
                }))
                .sort((a, b) => b.points - a.points);
        }

        function renderLeaderboard() {
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';
            const data = getLeaderboardData();

            data.forEach((user, index) => {
                const rank = index + 1;
                const row = tbody.insertRow();
                if (loggedInUser === user.username) {
                    row.classList.add('user-rank');
                }
                
                row.insertCell().textContent = rank;
                row.insertCell().innerHTML = `<span class="user-avatar" style="font-size: 1rem; margin-right: 10px;">${user.avatar}</span> ${user.username}`;
                row.insertCell().textContent = user.points;
            });
        }
        
        // --- Community Hub Functions (NEW) ---

        function saveCommunityPosts() {
            localStorage.setItem('ecoquest-posts', JSON.stringify(communityPosts));
        }

        function submitPost() {
            if (!checkLoginAndRedirect()) return;

            const postInput = document.getElementById('post-input');
            const content = postInput.value.trim();

            if (content.length < 5) {
                showNotification('Your post is too short (min 5 characters).', 3000);
                return;
            }

            const newPost = {
                id: Date.now(),
                username: loggedInUser,
                avatar: gameState.avatar,
                content: content,
                likes: [],
                timestamp: new Date().toISOString()
            };

            communityPosts.unshift(newPost); // Add to the beginning
            saveCommunityPosts();
            renderCommunityPosts();
            postInput.value = '';
            showNotification('Post shared to the community! üì£', 3000);
        }

        function toggleLike(postId) {
            if (!checkLoginAndRedirect()) return;

            const post = communityPosts.find(p => p.id === postId);
            if (!post) return;

            const userIndex = post.likes.indexOf(loggedInUser);

            if (userIndex === -1) {
                post.likes.push(loggedInUser); // Like
                showNotification('Liked post! ‚ù§Ô∏è', 1500);
            } else {
                post.likes.splice(userIndex, 1); // Unlike
                showNotification('Unliked post.', 1500);
            }

            saveCommunityPosts();
            renderCommunityPosts(); // Re-render to update the button state/count
        }

        function renderCommunityPosts() {
            const container = document.getElementById('community-posts-container');
            container.innerHTML = '';
            
            if (communityPosts.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #777; margin-top: 2rem;">Be the first to share an eco-thought! üåç</p>';
                return;
            }

            communityPosts.forEach(post => {
                const isLiked = post.likes.includes(loggedInUser);
                const postDate = new Date(post.timestamp).toLocaleDateString();

                const postElement = document.createElement('div');
                postElement.className = 'community-post';
                postElement.innerHTML = `
                    <div class="post-header">
                        <span class="post-avatar">${post.avatar}</span>
                        <span class="post-username">${post.username}</span>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-actions">
                        <button class="like-button ${isLiked ? 'liked' : ''}" onclick="toggleLike(${post.id})">
                            ${isLiked ? '‚ù§Ô∏è' : 'ü§ç'} Like (${post.likes.length})
                        </button>
                        <span>Posted on: ${postDate}</span>
                    </div>
                `;
                container.appendChild(postElement);
            });
        }
        
        // --- Game Functions (STUBS/FIXED) ---

        /** * FIX: Implemented closeGame function to clear content and close modal. 
         */
        function closeGame() {
            document.getElementById('gameModal').style.display = 'none';
            document.getElementById('gameContent').innerHTML = '';
        }

        function openGameModal(title, contentHTML, gameInitFn = null) {
            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = `<h3>${title}</h3><hr style="margin: 1rem 0;">${contentHTML}`;
            document.getElementById('gameModal').style.display = 'block';
            if (gameInitFn) {
                // Run the game setup function after content is loaded
                gameInitFn();
            }
        }

        /**
         * FIX: Implemented startRecyclingGame (with game stub)
         */
        function startRecyclingGame() {
            const gameHTML = `
                <div class="game-area">
                    <p>Drag the items to the correct bins!</p>
                    <div class="recycling-bins">
                        <div class="bin" data-type="paper">
                            <div class="bin-icon">üìÑ</div>
                            <div class="bin-label">Paper</div>
                        </div>
                        <div class="bin" data-type="plastic">
                            <div class="bin-icon">ü•§</div>
                            <div class="bin-label">Plastic</div>
                        </div>
                        <div class="bin" data-type="glass">
                            <div class="bin-icon">üçæ</div>
                            <div class="bin-label">Glass</div>
                        </div>
                        <div class="bin" data-type="compost">
                            <div class="bin-icon">üçé</div>
                            <div class="bin-label">Compost</div>
                        </div>
                    </div>
                    <div class="draggable-items" id="recycling-items">
                        Loading items...
                    </div>
                    <div id="game-status" style="margin-top: 1rem; font-weight: bold; color: #FF6B35;"></div>
                    <button class="cta-button" style="margin-top: 2rem;" onclick="closeGame()">Finish Game (Stub)</button>
                </div>
            `;
            openGameModal('Recycling Hero Mission', gameHTML, initializeRecyclingGame);
        }

        /**
         * FIX: Implemented initializeRecyclingGame (as a stub)
         */
        function initializeRecyclingGame() {
            const items = [
                { emoji: 'üì∞', type: 'paper' },
                { emoji: 'üß¥', type: 'plastic' },
                { emoji: 'üçå', type: 'compost' },
                { emoji: 'üì¶', type: 'paper' },
                { emoji: 'ü•õ', type: 'glass' },
            ];

            const container = document.getElementById('recycling-items');
            container.innerHTML = '';
            
            items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'draggable-item';
                itemEl.textContent = item.emoji;
                itemEl.draggable = true;
                itemEl.setAttribute('data-type', item.type);
                container.appendChild(itemEl);
            });
            
            // Note: Full drag-and-drop logic is complex. This is a visual stub.
            document.getElementById('game-status').textContent = 'Drag-and-drop is a stub. Click "Finish Game" to complete the quest.';
        }

        /**
         * FIX: Implemented startForestGame (stub)
         */
        function startForestGame() {
            const gameHTML = `
                <div class="game-area">
                    <p>Plant trees and save animals! (Game in progress)</p>
                    <div style="font-size: 5rem; margin: 2rem;">üå≥üêº</div>
                    <p>This mission will be about identifying local trees and planting virtual seeds.</p>
                    <button class="cta-button" style="margin-top: 2rem;" onclick="completeQuest('Forest Guardian', 50)">Complete Quest (Stub)</button>
                </div>
            `;
            openGameModal('Forest Guardian Mission', gameHTML);
        }

        /**
         * FIX: Implemented startSolarGame (stub)
         */
        function startSolarGame() {
            const gameHTML = `
                <div class="game-area">
                    <p>Design a city with solar and wind power! (Game in progress)</p>
                    <div style="font-size: 5rem; margin: 2rem;">‚òÄÔ∏èüèôÔ∏è</div>
                    <p>This mission will involve placing renewable energy sources on a map to meet power demand.</p>
                    <button class="cta-button" style="margin-top: 2rem;" onclick="completeQuest('Solar City Builder', 100)">Complete Quest (Stub)</button>
                </div>
            `;
            openGameModal('Solar City Builder Mission', gameHTML);
        }

        // A function to simulate quest completion (for stubs)
        function completeQuest(questName, points) {
            if (loggedInUser) {
                gameState.ecoPoints += points;
                gameState.questsCompleted += 1;
                gameState.questProgress[questName] = 100; // Mark as 100% complete
                // Example badge unlock
                if (questName === 'Recycling Hero' && !gameState.unlockedBadges.includes('recycling-novice')) {
                    gameState.unlockedBadges.push('recycling-novice');
                    gameState.badgesEarned += 1;
                    showNotification('üèÖ New Badge Unlocked: Recycling Novice!', 4000);
                }
                saveProgress();
                updateUI();
                showNotification(`Mission Complete! Earned ${points} Eco-Points! üåü`, 5000);
            }
            closeGame();
        }

        // --- Learn Functions (STUBS/FIXED) ---

        function showClimateChangeInfo() {
            const content = `
                <div class="learning-content">
                    <h3>What is Climate Change?</h3>
                    <p>Climate change refers to long-term shifts in temperatures and weather patterns. Since the 1800s, human activities like burning fossil fuels have been the main driver of climate change, primarily due to the emission of heat-trapping gases.</p>
                    <p>Key topics:</p>
                    <ul>
                        <li>The Greenhouse Effect (CO2 and Methane)</li>
                        <li>Melting Ice Caps and Sea Level Rise</li>
                        <li>Extreme Weather Events</li>
                    </ul>
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/dcxI7l70U8I" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>
            `;
            openGameModal('üåç Climate Change Basics', content);
        }

        function showWildlifeInfo() {
            const content = `
                <div class="learning-content">
                    <h3>Wildlife Conservation</h3>
                    <p>Conservation is the act of protecting animal and plant species and their habitats. Loss of habitat, pollution, and climate change are the biggest threats to wildlife.</p>
                    <p>How you can help:</p>
                    <ul>
                        <li>Reduce, Reuse, Recycle to minimize waste.</li>
                        <li>Support wildlife protection organizations.</li>
                        <li>Plant native plants in your yard.</li>
                    </ul>
                    <p>Every small action helps protect endangered species like the Giant Panda üêº and the Sea Turtle üê¢.</p>
                </div>
            `;
            openGameModal('üêº Wildlife Conservation', content);
        }

        function showOceanInfo() {
            const content = `
                <div class="learning-content">
                    <h3>Ocean Protection</h3>
                    <p>The ocean covers over 70% of our planet and provides half of the oxygen we breathe. However, it is under threat from plastic pollution and acidification.</p>
                    <p>Key facts:</p>
                    <ul>
                        <li>Microplastics are harmful to marine life.</li>
                        <li>Coral reefs are dying due to rising sea temperatures.</li>
                        <li>Sustainable fishing is crucial for ecosystem health.</li>
                    </ul>
                    <p>Let's work together to keep our oceans clean and healthy! üåä</p>
                </div>
            `;
            openGameModal('üåä Ocean Protection', content);
        }


        // --- Initialization ---

        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();

            // Set default view to home, or based on hash in URL
            const initialSection = window.location.hash ? window.location.hash.substring(1) : 'home';
            // Show section only if it's a valid ID
            if (document.getElementById(initialSection)) {
                showSection(initialSection);
            } else {
                showSection('home');
            }

            // Add dynamic floating elements
            const floatingContainer = document.querySelector('.floating-elements');
            const newElements = ['ü¶ã', 'üêù', 'üå∫', 'üå∏'];
            newElements.forEach((emoji, index) => {
                const element = document.createElement('div');
                element.className = 'leaf';
                element.textContent = emoji;
                element.style.left = Math.random() * 80 + '%';
                element.style.top = Math.random() * 80 + '%';
                element.style.animationDelay = index * 1.5 + 's';
                floatingContainer.appendChild(element);
            });
            
            if (loggedInUser) {
                showNotification(`Welcome back, ${loggedInUser}!`, 4000);
            } else if (localStorage.getItem('ecoquest-users') === null) {
                setTimeout(() => {
                    showNotification('üå± Welcome to Eco-Quest! Start your green adventure today!', 4000);
                }, 1000);
            }
        });

        document.addEventListener('dragend', function() {
            document.querySelectorAll('.bin').forEach(bin => {
                bin.classList.remove('highlight');
            });
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeGame();
                closeAuthModal();
            }
        });
    </script>
</body>
</html>
